CREATE TABLE USER (
	username varchar(30) primary key,
	password varchar(50) not null,
	nama varchar(30) not null,
	alamat text not null,
	peran int
);

insert into USER(username, password, nama, alamat, peran) values ('indra.eka', md5('admin'), 'Indra Eka Prasetya', 'Depok', 1);
insert into USER(username, password, nama, alamat, peran) values ('berty.chrismartin', md5('admin'), 'Berty Chrismartin Lumban Tobing', 'Depok', 2);
insert into USER(username, password, nama, alamat, peran) values ('ismail.hassan', md5('admin'), 'Ismail Hassan', 'Depok', 4);
insert into USER(username, password, nama, alamat, peran) values ('m.rasyid', md5('admin'), 'M Rasyid Ridho', 'Depok', 8);

CREATE TABLE KATEGORI_MENU (
	id int(5) primary key auto_increment,
	nama varchar(20) not null
);

insert into KATEGORI_MENU(nama) values ('Makanan');
insert into KATEGORI_MENU(nama) values ('Minuman');

CREATE TABLE MENU (
	id_kategori int(5) not null,
	id int(5) auto_increment,
	nama varchar(30) not null,
	harga_modal int not null,
	harga int not null,
	tersedia bool not null,
	deskripsi text not null,
	jumlah_jual int not null,
	primary key (id_kategori, id),
	key(id),
	foreign key (id_kategori) references KATEGORI_MENU (id) on update cascade on delete cascade
);



CREATE TABLE PESANAN (
	id int(5) primary key auto_increment,
	status int not null,
	no_meja int not null,
	tanggal date not null,
	username_koki varchar(30),
	username_kasir varchar(30),
	foreign key (username_koki) references USER(username) on update cascade on delete cascade,
	foreign key (username_kasir) references USER(username) on update cascade on delete cascade
);

CREATE TABLE DETAIL_PESANAN(
	id_pesanan int(5) not null,
	no int(5) not null,
	jumlah int not null,
	id_kategori int(5) not null,
	id_menu int(5) not null,
	primary key(id_pesanan, no),
	foreign key(id_pesanan) references PESANAN(id) on update cascade on delete cascade,
	foreign key(id_kategori, id_menu) references MENU(id_kategori, id) on update cascade on delete cascade
);

select		*
from		KATEGORI_MENU A, MENU B
where		A.id = B.id_kategori
order by 	A.nama, B.Nama;


// login
select	peran
from	USER
where	username = 'username' AND password = 'password'; 


// list account
select	nama, username
from	USER;

// list pesanan
select	*
from	PESANAN
where	username_pelayan = 'username';

// list account
select	*
from	USER;

// detail_pesanan
SELECT A.no, B.nama, B.harga, A.jumlah
FROM detail_pesanan AS A, menu AS B
WHERE id_pesanan = 1 AND B.id = A.id_menu
AND B.id_kategori = A.id_kategori
order by A.no;

// list pesanan
SELECT A.id, A.no_meja, A.tanggal, C.nama, sum(C.harga* B.jumlah) as total_harga
FROM pesanan AS A, detail_pesanan AS B, menu AS C
WHERE A.id = B.id_pesanan
AND C.id = B.id_menu
AND C.id_kategori = B.id_kategori
group by A.id;


		
